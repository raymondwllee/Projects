import json
import urllib.request
import time
import os #for environment variables
from os import system, name
from time import sleep
def clear():
  if name == 'nt':
    _ = system('cls')
  else:
    _ = system('clear')

url = f'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson' #data for earthquakes last 7 days magnitude 4.5 or more
response = urllib.request.urlopen(url)
result = json.loads(response.read()) #read json in to python
print("Number of earthquakes on Earth last 168 hours of magnitude 4.5 or higher:",result["metadata"]["count"],"\n")
time.sleep(2.5)
print("---------------------------------------------------------------")
quake = result["features"][0]["properties"] #variable to help comprehend complex JSON structure
print("\nThe most recent earthquake occured on:")
print("\t",time.ctime(quake['time']),"GMT")
print("\nLocation:", quake['place'])
print("\nMagnitude:", quake['mag'],"Richter Scale\n")
long = result['features'][0]['geometry']['coordinates'][0]#longitude
lat = result['features'][0]['geometry']['coordinates'][1] #latitude
print("Longitude:", long, "\tLatitude:", lat)
print(f"\nLink to map of earthquake location:\nhttps://www.purpleair.com/map?opt=1/mAQI/a10/cC0#11/{lat}/{long}")
my_secret = os.environ['APIkey'] #to hide the free API key
API_KEY = os.getenv("APIkey") #define environmental variable
url2 = f'http://open.mapquestapi.com/geocoding/v1/reverse?key={API_KEY}{lat},{long}&includeRoadMetadata=true&includeNearestIntersection=true'
#long and lat variable inserted into url2
response2 = urllib.request.urlopen(url2)
result2 = json.loads(response2.read()) #A second API to obtain country code of earthquake
country_code = result2['results'][0]['locations'][0]['adminArea1']
print("\nFor more information on this earthquake, please visit:")
print(quake['url']) #link to USGS website
url3 = f'https://restcountries.eu/rest/v2/alpha/{country_code}' # API to obtain information of country where the earthquake happened.
response3 = urllib.request.urlopen(url3)
result3 = json.loads(response3.read())
print("\nFor more information on", result3['name'],":")
choice = input("\nPress to continue. ")
clear() #clear screen
print(result3['name'], ",also known as", result3['altSpellings'][1], ", is located in", result3['subregion'],".")
time.sleep(2.5)
print("\nIt has a population of", result3['population'], ",and the national language of", result3['name'], "is", result3['languages'][0]['name'], ".\n")
time.sleep(2.5)
print("The capital of", result3['name'], "is", result3['capital'],".\n")
time.sleep(2.5)
print(f"Please click the link below for more information on {result3['name']}.\n")
print(f"https://en.wikipedia.org/wiki/{result3['name']}")
